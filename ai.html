<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Analyst</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div class="container ai-page">
    <div id="include-header"></div>
    <div id="include-stats"></div>

    <div class="ai-layout" id="ai-layout">
      <section class="ai-chat" aria-label="AI analyst conversation">
        <div class="ai-thread" id="ai-thread"></div>
        <div class="ai-input" id="ai-input">
          <div class="scope-selector" role="group" aria-label="Analysis scope">
            <label><input type="radio" name="analysisScope" value="all" checked> Analyze all bets</label>
            <label><input type="radio" name="analysisScope" value="filtered"> Analyze current filters</label>
          </div>
          <div class="filter-controls" id="filter-controls" hidden>
            <div class="filter-row">
              <label>
                From
                <input type="date" id="filter-start" />
              </label>
              <label>
                To
                <input type="date" id="filter-end" />
              </label>
            </div>
            <div class="filter-row">
              <label>
                Sports
                <select id="filter-sports" multiple size="4"></select>
              </label>
              <label>
                Markets
                <select id="filter-markets" multiple size="4"></select>
              </label>
              <label>
                Outcomes
                <select id="filter-outcomes" multiple size="4"></select>
              </label>
            </div>
            <button class="btn btn-secondary" id="apply-filters-btn">Apply filters</button>
          </div>
          <div class="ai-input-row">
            <textarea id="ai-question" rows="2" placeholder="Ask about performance, trends, or strategy..." aria-label="Ask the analyst"></textarea>
            <button class="btn" id="send-question-btn">Send</button>
          </div>
          <div class="ai-hints" id="ai-hints"></div>
        </div>
      </section>

      <aside class="ai-context" aria-label="Analysis context">
        <div class="context-card">
          <h2>Snapshot</h2>
          <div class="context-metrics" id="context-metrics"></div>
          <div class="context-extra" id="context-extra"></div>
        </div>
        <div class="context-card">
          <h3>Chart</h3>
          <canvas id="ai-chart" width="320" height="220" role="img" aria-label="AI generated chart"></canvas>
          <p class="chart-caption" id="chart-caption"></p>
        </div>
        <div class="context-card">
          <h3>Breakdowns</h3>
          <div class="context-breakdowns" id="context-breakdowns"></div>
        </div>
        <div class="context-card">
          <h3>Follow-up ideas</h3>
          <ul id="follow-ups" class="follow-ups"></ul>
        </div>
      </aside>
    </div>
  </div>

  <script type="module" src="js/loadShared.js"></script>
  <script type="module" src="js/ai.js"></script>
  <script type="module" src="js/auth.js"></script>
  <script>
    window.addEventListener('shared:loaded', () => {
      const title = document.getElementById('page-title');
      const subtitle = document.getElementById('page-subtitle');
      const learnMore = document.getElementById('learn-more-link');
      if (title) title.textContent = 'ðŸ¤– AI Analyst';
      if (subtitle) subtitle.textContent = 'Chat with your betting data specialist';
      if (learnMore) learnMore.style.display = 'none';
    });
  </script>
</body>
</html>
